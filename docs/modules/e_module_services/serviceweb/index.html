<!doctype html><html lang=fr dir=ltr><head><meta charset=UTF-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="
  Projet de création d&rsquo;un service web
  #

Dans ce projet, le serveur utilise la notion de &ldquo;contexte&rdquo; ou &ldquo;route&rdquo; pour diriger les requêtes vers différents gestionnaires. Un contexte est défini par un chemin d&rsquo;URL, comme &ldquo;/&rdquo; pour la racine du site ou &ldquo;/heure&rdquo; pour une ressource spécifique. Chaque contexte est associé à une fonction qui gère les requêtes entrantes, permettant au serveur de servir différents contenus ou d&rsquo;exécuter différentes actions en fonction de l&rsquo;URL demandée."><meta name=theme-color media="(prefers-color-scheme: light)" content="#ffffff"><meta name=theme-color media="(prefers-color-scheme: dark)" content="#343a40"><meta name=color-scheme content="light dark"><meta property="og:url" content="https://lemire.github.io/orientee_donnees/docs/modules/e_module_services/serviceweb/"><meta property="og:site_name" content="Programmation orientée-données"><meta property="og:title" content="Création d'un service web"><meta property="og:description" content="Projet de création d’un service web # Dans ce projet, le serveur utilise la notion de “contexte” ou “route” pour diriger les requêtes vers différents gestionnaires. Un contexte est défini par un chemin d’URL, comme “/” pour la racine du site ou “/heure” pour une ressource spécifique. Chaque contexte est associé à une fonction qui gère les requêtes entrantes, permettant au serveur de servir différents contenus ou d’exécuter différentes actions en fonction de l’URL demandée."><meta property="og:locale" content="fr"><meta property="og:type" content="article"><meta property="article:section" content="docs"><title>Création d'un service web | Programmation orientée-données</title><link rel=icon href=/orientee_donnees/favicon.png><link rel=manifest href=/orientee_donnees/manifest.json><link rel=canonical href=https://lemire.github.io/orientee_donnees/docs/modules/e_module_services/serviceweb/><link rel=stylesheet href=/orientee_donnees/book.min.a006656c8516e75b9916bf87553cdae09b7d022a0ef8c51fcafcb935e4e3d410.css integrity="sha256-oAZlbIUW51uZFr+HVTza4Jt9AioO+MUfyvy5NeTj1BA=" crossorigin=anonymous><script defer src=/orientee_donnees/fuse.min.js></script><script defer src=/orientee_donnees/fr.search.min.dce47adacba208ad47187a1fda0363ae9218034c87245fda0aac0596eb330815.js integrity="sha256-3OR62suiCK1HGHof2gNjrpIYA0yHJF/aCqwFluszCBU=" crossorigin=anonymous></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.css><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/katex.min.js></script><script defer src=https://cdn.jsdelivr.net/npm/katex@0.16.22/dist/contrib/auto-render.min.js onload=renderMathInElement(document.body)></script></head><body dir=ltr><input type=checkbox class="hidden toggle" id=menu-control>
<input type=checkbox class="hidden toggle" id=toc-control><main class="container flex"><aside class=book-menu><div class=book-menu-content><nav><h2 class=book-brand><a class="flex align-center" href=/orientee_donnees/><img src=/orientee_donnees/favicon.png alt=Logo class=book-icon><span>Programmation orientée-données</span></a></h2><div class="book-search hidden"><input type=text id=book-search-input placeholder=Rechercher aria-label=Rechercher maxlength=64 data-hotkeys=s/><div class="book-search-spinner hidden"></div><ul id=book-search-results></ul></div><script>document.querySelector(".book-search").classList.remove("hidden")</script><ul><li><a href=/orientee_donnees/docs/modules/>Modules</a><ul><li><input type=checkbox id=section-e0cc4658cb7e0b0785f48bc734a0d868 class=toggle>
<label for=section-e0cc4658cb7e0b0785f48bc734a0d868 class=flex><a href=/orientee_donnees/docs/modules/a_module_json/ class=flex-auto>Module JSON</a></label><ul><li><a href=/orientee_donnees/docs/modules/a_module_json/json/>JSON</a></li><li><a href=/orientee_donnees/docs/modules/a_module_json/geojson/>GeoJSON</a></li><li><a href=/orientee_donnees/docs/modules/a_module_json/markdown/>MarkDown</a></li><li><a href=/orientee_donnees/docs/modules/a_module_json/javascript/>JavaScript et JSON</a></li><li><a href=/orientee_donnees/docs/modules/a_module_json/jq/>Activité avec jq</a></li><li><a href=/orientee_donnees/docs/modules/a_module_json/gjson/>Google Gson</a></li><li><a href=/orientee_donnees/docs/modules/a_module_json/encodage_des_caracteres_unicode/>Encodage des caractères Unicode</a></li><li><a href=/orientee_donnees/docs/modules/a_module_json/travail/>Travail noté</a></li></ul></li><li><input type=checkbox id=section-5dba5cff8314754d322613989dda2ee4 class=toggle>
<label for=section-5dba5cff8314754d322613989dda2ee4 class=flex><a href=/orientee_donnees/docs/modules/b_module_xml/ class=flex-auto>Module XML</a></label><ul><li><input type=checkbox id=section-b0f20b451fe2916a31453d5cbda26a99 class=toggle>
<label for=section-b0f20b451fe2916a31453d5cbda26a99 class=flex><a role=button class=flex-auto>Les fondements</a></label><ul><li><a href=/orientee_donnees/docs/modules/b_module_xml/base/introduction_a_xml/>Introduction à XML</a></li><li><a href=/orientee_donnees/docs/modules/b_module_xml/base/principes_du_xml/>Principes du XML</a></li><li><a href=/orientee_donnees/docs/modules/b_module_xml/base/creer_un_fichier_xml/>Créer un fichier XML</a></li><li><a href=/orientee_donnees/docs/modules/b_module_xml/base/mise_en_forme_du_xml/>Mise en forme du XML</a></li><li><a href=/orientee_donnees/docs/modules/b_module_xml/base/laboratoire_sur_la_structure_en_arbre_des_documents_xml/>Laboratoire sur la structure en arbre des documents XML</a></li><li><a href=/orientee_donnees/docs/modules/b_module_xml/base/labo/>Vérificateur de XML bien formé</a></li><li><a href=/orientee_donnees/docs/modules/b_module_xml/base/autoevaluation/>Autoévaluation XML</a></li></ul></li><li><input type=checkbox id=section-344b47eee8a14c6b3ccb143c1f5bf702 class=toggle>
<label for=section-344b47eee8a14c6b3ccb143c1f5bf702 class=flex><a role=button class=flex-auto>Validation</a></label><ul><li><a href=/orientee_donnees/docs/modules/b_module_xml/valid/definition_de_type_de_document/>Définition de type de document</a></li><li><a href=/orientee_donnees/docs/modules/b_module_xml/valid/validation_de_documents_xml/>Validation de documents XML</a></li><li><a href=/orientee_donnees/docs/modules/b_module_xml/valid/autoevaluation_dtd/>Autoévaluation</a></li></ul></li><li><input type=checkbox id=section-d96b044d241e9b77e9c0592b528dc057 class=toggle>
<label for=section-d96b044d241e9b77e9c0592b528dc057 class=flex><a role=button class=flex-auto>Espaces de nom</a></label><ul><li><a href=/orientee_donnees/docs/modules/b_module_xml/espaces/espace_de_nom/>Espace de noms</a></li><li><a href=/orientee_donnees/docs/modules/b_module_xml/espaces/autoevaluation_adv/>Autoévaluation</a></li></ul></li><li><input type=checkbox id=section-7677844365e3481ee5b7c1ca5bb4c38f class=toggle>
<label for=section-7677844365e3481ee5b7c1ca5bb4c38f class=flex><a role=button class=flex-auto>Exemples</a></label><ul><li><a href=/orientee_donnees/docs/modules/b_module_xml/examples/le_fichier_pomxml_en_java/>Le fichier pom.xml en Java</a></li><li><a href=/orientee_donnees/docs/modules/b_module_xml/examples/le_fichier_sitemapxml/>Le fichier sitemap.xml</a></li><li><a href=/orientee_donnees/docs/modules/b_module_xml/examples/les_fichiers_csproj_en_c/>Les fichiers csproj en C#</a></li><li><a href=/orientee_donnees/docs/modules/b_module_xml/examples/rss/>Les formats RSS et Atom</a></li><li><a href=/orientee_donnees/docs/modules/b_module_xml/examples/three/>X3D</a></li><li><a href=/orientee_donnees/docs/modules/b_module_xml/examples/le_fichier_androidmanifestxml/>Le fichier AndroidManifest.xml</a></li><li><a href=/orientee_donnees/docs/modules/b_module_xml/examples/docx_microsoft_word/>Office Open XML</a></li></ul></li><li><input type=checkbox id=section-3414f79d7e98c78ad1d3dbda25a1f55a class=toggle>
<label for=section-3414f79d7e98c78ad1d3dbda25a1f55a class=flex><a role=button class=flex-auto>RDF</a></label><ul><li><a href=/orientee_donnees/docs/modules/b_module_xml/rdf/introduction_au_rdf/>Introduction au RDF</a></li><li><a href=/orientee_donnees/docs/modules/b_module_xml/rdf/applications_du_rdf/>Applications du RDF</a></li><li><a href=/orientee_donnees/docs/modules/b_module_xml/rdf/autoevaluation_rdf/>Autoévaluation</a></li><li><a href=/orientee_donnees/docs/modules/b_module_xml/rdf/sparql/>Activité SPARQL</a></li></ul></li><li><input type=checkbox id=section-fb1c5b6035fd6d3caf7148dac6057b07 class=toggle>
<label for=section-fb1c5b6035fd6d3caf7148dac6057b07 class=flex><a role=button class=flex-auto>Modèles de programmation</a></label><ul><li><a href=/orientee_donnees/docs/modules/b_module_xml/programmation/dom/>DOM</a></li><li><a href=/orientee_donnees/docs/modules/b_module_xml/programmation/javascript/>JavaScript et DOM</a></li><li><a href=/orientee_donnees/docs/modules/b_module_xml/programmation/autoevaluation/>Autoévaluation DOM</a></li><li><a href=/orientee_donnees/docs/modules/b_module_xml/programmation/jackson/>Activité JSON/XML avec Jackson</a></li></ul></li><li><a href=/orientee_donnees/docs/modules/b_module_xml/travail/>Travail noté</a></li></ul></li><li><input type=checkbox id=section-5d65d8b100e58c6d134cd4da58e1cd2c class=toggle>
<label for=section-5d65d8b100e58c6d134cd4da58e1cd2c class=flex><a href=/orientee_donnees/docs/modules/c_module_xslt/ class=flex-auto>Module XPath, XSLT, XQuery</a></label><ul><li><input type=checkbox id=section-7ac06c5c6cb170ae259ae8aaa0f2fa28 class=toggle>
<label for=section-7ac06c5c6cb170ae259ae8aaa0f2fa28 class=flex><a role=button class=flex-auto>XPath</a></label><ul><li><a href=/orientee_donnees/docs/modules/c_module_xslt/xpath/xpath_un_premier_laboratoire/>XPath : un premier laboratoire</a></li><li><a href=/orientee_donnees/docs/modules/c_module_xslt/xpath/xpath_approfondissement/>XPath : approfondissement</a></li><li><a href=/orientee_donnees/docs/modules/c_module_xslt/xpath/xpath_en_ligne_java/>XPath avec Java</a></li><li><a href=/orientee_donnees/docs/modules/c_module_xslt/xpath/xpath_second_laboratoire/>XPath : second laboratoire</a></li><li><a href=/orientee_donnees/docs/modules/c_module_xslt/xpath/autoevaluation_xpath/>Autoévaluation</a></li><li><a href=/orientee_donnees/docs/modules/c_module_xslt/xpath/xpath_20_et_30/>XPath 2.0 et 3.0</a></li></ul></li><li><input type=checkbox id=section-f547d6e3d6ea0eaec3e702c4dfd2c47e class=toggle>
<label for=section-f547d6e3d6ea0eaec3e702c4dfd2c47e class=flex><a role=button class=flex-auto>XSLT</a></label><ul><li><a href=/orientee_donnees/docs/modules/c_module_xslt/xslt/introduction_au_xslt/>Introduction au XSLT</a></li><li><a href=/orientee_donnees/docs/modules/c_module_xslt/xslt/xslt_en_ligne/>XSLT en ligne</a></li><li><a href=/orientee_donnees/docs/modules/c_module_xslt/xslt/xslt_en_ligne_java/>XSLT avec Java</a></li><li><a href=/orientee_donnees/docs/modules/c_module_xslt/xslt/un_peu_plus_de_xslt_fonctionnement_de_base_template_et_value-of/>Un peu plus de XSLT : fonctionnement de base, template et value-of</a></li><li><a href=/orientee_donnees/docs/modules/c_module_xslt/xslt/les_valeurs_dattribut/>Les valeurs d’attribut</a></li><li><a href=/orientee_donnees/docs/modules/c_module_xslt/xslt/xslt_modulaire/>XSLT modulaire</a></li><li><a href=/orientee_donnees/docs/modules/c_module_xslt/xslt/les_noms_delements/>Les noms d’éléments</a></li><li><a href=/orientee_donnees/docs/modules/c_module_xslt/xslt/attribut_mode/>Attribut mode</a></li><li><a href=/orientee_donnees/docs/modules/c_module_xslt/xslt/la_fonction_generate-id/>La fonction generate-id</a></li><li><a href=/orientee_donnees/docs/modules/c_module_xslt/xslt/les_tests/>Les tests</a></li><li><a href=/orientee_donnees/docs/modules/c_module_xslt/xslt/les_boucles/>Les boucles</a></li><li><a href=/orientee_donnees/docs/modules/c_module_xslt/xslt/cles_et_aggregation/>Clés et aggrégation</a></li><li><a href=/orientee_donnees/docs/modules/c_module_xslt/xslt/generer_des_noeuds_dynamiquement/>Générer des noeuds dynamiquement</a></li><li><a href=/orientee_donnees/docs/modules/c_module_xslt/xslt/variables_et_parametres/>Variables et paramètres</a></li><li><a href=/orientee_donnees/docs/modules/c_module_xslt/xslt/mise_en_forme/>Mise en forme</a></li><li><a href=/orientee_donnees/docs/modules/c_module_xslt/xslt/espaces_de_noms/>Espaces de noms</a></li><li><a href=/orientee_donnees/docs/modules/c_module_xslt/xslt/les_axes/>Les axes</a></li><li><a href=/orientee_donnees/docs/modules/c_module_xslt/xslt/etude_dun_exemple_docbook/>Étude d’un exemple (DocBook)</a></li><li><a href=/orientee_donnees/docs/modules/c_module_xslt/xslt/laboratoire_xslt/>Laboratoire XSLT</a></li><li><a href=/orientee_donnees/docs/modules/c_module_xslt/xslt/laboratoire_xslt_avec_python_optionnel/>Laboratoire XSLT avec Python (optionnel)</a></li><li><a href=/orientee_donnees/docs/modules/c_module_xslt/xslt/xslt_20_et_30/>XSLT 2.0 et 3.0</a></li><li><a href=/orientee_donnees/docs/modules/c_module_xslt/xslt/autoevaluation_xslt/>Autoévaluation</a></li></ul></li><li><input type=checkbox id=section-b3c85205c7eb5b729c0be10ddbd24290 class=toggle>
<label for=section-b3c85205c7eb5b729c0be10ddbd24290 class=flex><a role=button class=flex-auto>XQuery</a></label><ul><li><a href=/orientee_donnees/docs/modules/c_module_xslt/xquery/xquery/>XQuery</a></li><li><a href=/orientee_donnees/docs/modules/c_module_xslt/xquery/laboratoire_xquery_avec_python_optionnel/>Laboratoire XQuery avec Python (optionnel)</a></li></ul></li><li><a href=/orientee_donnees/docs/modules/c_module_xslt/travail/>Travail noté</a></li></ul></li><li><input type=checkbox id=section-2a04c3a72cdb954ae36ef63df297319a class=toggle>
<label for=section-2a04c3a72cdb954ae36ef63df297319a class=flex><a href=/orientee_donnees/docs/modules/d_module_html/ class=flex-auto>Module HTML, CSS, SVG, MathML</a></label><ul><li><a href=/orientee_donnees/docs/modules/d_module_html/xhtml/>XHTML</a></li><li><a href=/orientee_donnees/docs/modules/d_module_html/html_5/>HTML 5</a></li><li><a href=/orientee_donnees/docs/modules/d_module_html/autoevaluation/>Autoévaluation HTML</a></li><li><a href=/orientee_donnees/docs/modules/d_module_html/css/>CSS</a></li><li><a href=/orientee_donnees/docs/modules/d_module_html/css2/>CSS (partie 2)</a></li><li><a href=/orientee_donnees/docs/modules/d_module_html/css3/>CSS (partie 3)</a></li><li><a href=/orientee_donnees/docs/modules/d_module_html/laboratoire_css/>Laboratoire CSS</a></li><li><a href=/orientee_donnees/docs/modules/d_module_html/svg/>SVG</a></li><li><a href=/orientee_donnees/docs/modules/d_module_html/mathml/>MathML</a></li><li><a href=/orientee_donnees/docs/modules/d_module_html/cssmathml/>Laboratoire CSS/MathML</a></li><li><a href=/orientee_donnees/docs/modules/d_module_html/autoevaluation_css/>Autoévaluation CSS</a></li><li><a href=/orientee_donnees/docs/modules/d_module_html/travail/>Travail noté</a></li></ul></li><li><input type=checkbox id=section-d04fad4b07d7c0c5b266f3694fc3c8af class=toggle checked>
<label for=section-d04fad4b07d7c0c5b266f3694fc3c8af class=flex><a href=/orientee_donnees/docs/modules/e_module_services/ class=flex-auto>Module Services et YAML</a></label><ul><li><a href=/orientee_donnees/docs/modules/e_module_services/serveurweb/>Serveur Web Java</a></li><li><a href=/orientee_donnees/docs/modules/e_module_services/base64/>Base64</a></li><li><a href=/orientee_donnees/docs/modules/e_module_services/asynchronous_javascript_and_xml_ajax/>Chargement XML/JSON en JavaScript</a></li><li><a href=/orientee_donnees/docs/modules/e_module_services/introservicesweb/>Introduction aux services web</a></li><li><a href=/orientee_donnees/docs/modules/e_module_services/serviceweb/ class=active>Création d'un service web</a></li><li><a href=/orientee_donnees/docs/modules/e_module_services/yaml/>YAML</a></li><li><a href=/orientee_donnees/docs/modules/e_module_services/travail/>Travail noté</a></li></ul></li></ul></li><li><input type=checkbox id=section-bfca035f077c4a3a8e327bb4e5d9433e class=toggle>
<label for=section-bfca035f077c4a3a8e327bb4e5d9433e class=flex><a role=button class=flex-auto>Contenu suppplémentaire</a></label><ul><li><a href=/orientee_donnees/docs/extra/glossaire/>Glossaire</a></li><li><a href=/orientee_donnees/docs/extra/pense-bete_xml/>Pense-bête XML</a></li><li><a href=/orientee_donnees/docs/extra/pense-bete_json/>Pense-bête JSON</a></li><li><a href=/orientee_donnees/docs/extra/pense-bete_yaml/>Pense-bête YAML</a></li><li><a href=/orientee_donnees/docs/extra/professeur/>Professeur</a></li></ul></li><li><a href=/orientee_donnees/docs/travail_integration/>Travail d'intégration</a></li><li><a href=/orientee_donnees/docs/evaluation/>Évaluation et feuille de route</a></li></ul></nav><script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script></div></aside><div class=book-page><header class=book-header><div class="flex align-center justify-between"><label for=menu-control><img src=/orientee_donnees/svg/menu.svg class=book-icon alt=Menu></label><h3>Création d'un service web</h3><label for=toc-control><img src=/orientee_donnees/svg/toc.svg class=book-icon alt="Table of Contents"></label></div><aside class="hidden clearfix"><nav id=TableOfContents><ul><li><a href=#fichiers>Fichiers</a></li><li><a href=#utilisation>Utilisation</a></li><li><a href=#description-du-code>Description du code</a><ul><li><a href=#serveurheurejava>ServeurHeure.java</a></li><li><a href=#indexhtml>index.html</a></li></ul></li><li><a href=#activités-suggérées>Activités suggérées</a></li></ul></nav></aside></header><article class="markdown book-article"><h1 id=projet-de-création-dun-service-web>Projet de création d&rsquo;un service web
<a class=anchor href=#projet-de-cr%c3%a9ation-dun-service-web>#</a></h1><p>Dans ce projet, le serveur utilise la notion de &ldquo;contexte&rdquo; ou &ldquo;route&rdquo; pour diriger les requêtes vers différents gestionnaires. Un contexte est défini par un chemin d&rsquo;URL, comme &ldquo;/&rdquo; pour la racine du site ou &ldquo;/heure&rdquo; pour une ressource spécifique. Chaque contexte est associé à une fonction qui gère les requêtes entrantes, permettant au serveur de servir différents contenus ou d&rsquo;exécuter différentes actions en fonction de l&rsquo;URL demandée.</p><p>Ce projet est un serveur simple en Java qui sert une page HTML sur la racine (<code>/</code>) et fournit l&rsquo;heure actuelle en XML sur <code>/heure</code>.</p><h2 id=fichiers>Fichiers
<a class=anchor href=#fichiers>#</a></h2><p>Copiez ces fichiers dans un répertoire.</p><p><code>ServeurHeure.java</code> :</p><div class=highlight><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-java data-lang=java><span style=display:flex><span><span style=color:#cf222e>import</span><span style=color:#fff> </span><span style=color:#24292e>com.sun.net.httpserver.HttpServer</span><span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#cf222e>import</span><span style=color:#fff> </span><span style=color:#24292e>com.sun.net.httpserver.HttpExchange</span><span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#cf222e>import</span><span style=color:#fff> </span><span style=color:#24292e>javax.xml.stream.XMLOutputFactory</span><span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#cf222e>import</span><span style=color:#fff> </span><span style=color:#24292e>javax.xml.stream.XMLStreamWriter</span><span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#cf222e>import</span><span style=color:#fff> </span><span style=color:#24292e>java.io.IOException</span><span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#cf222e>import</span><span style=color:#fff> </span><span style=color:#24292e>java.io.OutputStream</span><span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#cf222e>import</span><span style=color:#fff> </span><span style=color:#24292e>java.io.StringWriter</span><span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#cf222e>import</span><span style=color:#fff> </span><span style=color:#24292e>java.net.InetSocketAddress</span><span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#cf222e>import</span><span style=color:#fff> </span><span style=color:#24292e>java.nio.file.Files</span><span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#cf222e>import</span><span style=color:#fff> </span><span style=color:#24292e>java.nio.file.Paths</span><span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#cf222e>import</span><span style=color:#fff> </span><span style=color:#24292e>java.time.LocalDateTime</span><span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#cf222e>import</span><span style=color:#fff> </span><span style=color:#24292e>java.time.format.DateTimeFormatter</span><span style=color:#1f2328>;</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#cf222e>public</span><span style=color:#fff> </span><span style=color:#cf222e>class</span> <span style=color:#1f2328>ServeurHeure</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>private</span><span style=color:#fff> </span><span style=color:#cf222e>static</span><span style=color:#fff> </span><span style=color:#cf222e>final</span><span style=color:#fff> </span>XMLOutputFactory<span style=color:#fff> </span>xmlFactory<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>XMLOutputFactory<span style=color:#1f2328>.</span><span style=color:#1f2328>newFactory</span><span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>private</span><span style=color:#fff> </span><span style=color:#cf222e>static</span><span style=color:#fff> </span>String<span style=color:#fff> </span><span style=color:#6639ba>genererXmlHeure</span><span style=color:#1f2328>()</span><span style=color:#fff> </span><span style=color:#cf222e>throws</span><span style=color:#fff> </span>Exception<span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span>StringWriter<span style=color:#fff> </span>stringWriter<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span><span style=color:#cf222e>new</span><span style=color:#fff> </span>StringWriter<span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span>XMLStreamWriter<span style=color:#fff> </span>xml<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>xmlFactory<span style=color:#1f2328>.</span><span style=color:#1f2328>createXMLStreamWriter</span><span style=color:#1f2328>(</span>stringWriter<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span>xml<span style=color:#1f2328>.</span><span style=color:#1f2328>writeStartDocument</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;UTF-8&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;1.0&#34;</span><span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span>xml<span style=color:#1f2328>.</span><span style=color:#1f2328>writeStartElement</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;heure&#34;</span><span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span>xml<span style=color:#1f2328>.</span><span style=color:#1f2328>writeCharacters</span><span style=color:#1f2328>(</span>DateTimeFormatter<span style=color:#1f2328>.</span><span style=color:#1f2328>ISO_LOCAL_DATE_TIME</span><span style=color:#1f2328>.</span><span style=color:#1f2328>format</span><span style=color:#1f2328>(</span>LocalDateTime<span style=color:#1f2328>.</span><span style=color:#1f2328>now</span><span style=color:#1f2328>()));</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span>xml<span style=color:#1f2328>.</span><span style=color:#1f2328>writeEndElement</span><span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span>xml<span style=color:#1f2328>.</span><span style=color:#1f2328>writeEndDocument</span><span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span>xml<span style=color:#1f2328>.</span><span style=color:#1f2328>flush</span><span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span>xml<span style=color:#1f2328>.</span><span style=color:#1f2328>close</span><span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#cf222e>return</span><span style=color:#fff> </span>stringWriter<span style=color:#1f2328>.</span><span style=color:#1f2328>toString</span><span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#cf222e>public</span><span style=color:#fff> </span><span style=color:#cf222e>static</span><span style=color:#fff> </span><span style=color:#cf222e>void</span><span style=color:#fff> </span><span style=color:#6639ba>main</span><span style=color:#1f2328>(</span>String<span style=color:#0550ae>[]</span><span style=color:#fff> </span>args<span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#cf222e>throws</span><span style=color:#fff> </span>IOException<span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span>HttpServer<span style=color:#fff> </span>server<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>HttpServer<span style=color:#1f2328>.</span><span style=color:#1f2328>create</span><span style=color:#1f2328>(</span><span style=color:#cf222e>new</span><span style=color:#fff> </span>InetSocketAddress<span style=color:#1f2328>(</span>8000<span style=color:#1f2328>),</span><span style=color:#fff> </span>0<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span>server<span style=color:#1f2328>.</span><span style=color:#1f2328>createContext</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;/&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>exchange<span style=color:#fff> </span><span style=color:#0550ae>-&gt;</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#cf222e>if</span><span style=color:#fff> </span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;GET&#34;</span><span style=color:#1f2328>.</span><span style=color:#1f2328>equals</span><span style=color:#1f2328>(</span>exchange<span style=color:#1f2328>.</span><span style=color:#1f2328>getRequestMethod</span><span style=color:#1f2328>()))</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>                </span><span style=color:#cf222e>try</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>                    </span>String<span style=color:#fff> </span>html<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span><span style=color:#cf222e>new</span><span style=color:#fff> </span>String<span style=color:#1f2328>(</span>Files<span style=color:#1f2328>.</span><span style=color:#1f2328>readAllBytes</span><span style=color:#1f2328>(</span>Paths<span style=color:#1f2328>.</span><span style=color:#1f2328>get</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;index.html&#34;</span><span style=color:#1f2328>)),</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;UTF-8&#34;</span><span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>                    </span><span style=color:#cf222e>byte</span><span style=color:#0550ae>[]</span><span style=color:#fff> </span>response<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>html<span style=color:#1f2328>.</span><span style=color:#1f2328>getBytes</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;UTF-8&#34;</span><span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>                    </span>exchange<span style=color:#1f2328>.</span><span style=color:#1f2328>getResponseHeaders</span><span style=color:#1f2328>().</span><span style=color:#1f2328>set</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;Content-Type&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;text/html; charset=UTF-8&#34;</span><span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>                    </span>exchange<span style=color:#1f2328>.</span><span style=color:#1f2328>sendResponseHeaders</span><span style=color:#1f2328>(</span>200<span style=color:#1f2328>,</span><span style=color:#fff> </span>response<span style=color:#1f2328>.</span><span style=color:#1f2328>length</span><span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>                    </span><span style=color:#cf222e>try</span><span style=color:#fff> </span><span style=color:#1f2328>(</span>OutputStream<span style=color:#fff> </span>os<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>exchange<span style=color:#1f2328>.</span><span style=color:#1f2328>getResponseBody</span><span style=color:#1f2328>())</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>                        </span>os<span style=color:#1f2328>.</span><span style=color:#1f2328>write</span><span style=color:#1f2328>(</span>response<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>                    </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>                </span><span style=color:#1f2328>}</span><span style=color:#fff> </span><span style=color:#cf222e>catch</span><span style=color:#fff> </span><span style=color:#1f2328>(</span>Exception<span style=color:#fff> </span>e<span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>                    </span>exchange<span style=color:#1f2328>.</span><span style=color:#1f2328>sendResponseHeaders</span><span style=color:#1f2328>(</span>500<span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>-</span>1<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>                </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#1f2328>}</span><span style=color:#fff> </span><span style=color:#cf222e>else</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>                </span>exchange<span style=color:#1f2328>.</span><span style=color:#1f2328>sendResponseHeaders</span><span style=color:#1f2328>(</span>405<span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>-</span>1<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#1f2328>});</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span>server<span style=color:#1f2328>.</span><span style=color:#1f2328>createContext</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;/heure&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span>exchange<span style=color:#fff> </span><span style=color:#0550ae>-&gt;</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#cf222e>if</span><span style=color:#fff> </span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;GET&#34;</span><span style=color:#1f2328>.</span><span style=color:#1f2328>equals</span><span style=color:#1f2328>(</span>exchange<span style=color:#1f2328>.</span><span style=color:#1f2328>getRequestMethod</span><span style=color:#1f2328>()))</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>                </span><span style=color:#cf222e>try</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>                    </span>String<span style=color:#fff> </span>xml<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>genererXmlHeure<span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>                    </span><span style=color:#cf222e>byte</span><span style=color:#0550ae>[]</span><span style=color:#fff> </span>response<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>xml<span style=color:#1f2328>.</span><span style=color:#1f2328>getBytes</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;UTF-8&#34;</span><span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>                    </span>exchange<span style=color:#1f2328>.</span><span style=color:#1f2328>getResponseHeaders</span><span style=color:#1f2328>().</span><span style=color:#1f2328>set</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;Content-Type&#34;</span><span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0a3069>&#34;application/xml; charset=UTF-8&#34;</span><span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>                    </span>exchange<span style=color:#1f2328>.</span><span style=color:#1f2328>sendResponseHeaders</span><span style=color:#1f2328>(</span>200<span style=color:#1f2328>,</span><span style=color:#fff> </span>response<span style=color:#1f2328>.</span><span style=color:#1f2328>length</span><span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>                    </span><span style=color:#cf222e>try</span><span style=color:#fff> </span><span style=color:#1f2328>(</span>OutputStream<span style=color:#fff> </span>os<span style=color:#fff> </span><span style=color:#0550ae>=</span><span style=color:#fff> </span>exchange<span style=color:#1f2328>.</span><span style=color:#1f2328>getResponseBody</span><span style=color:#1f2328>())</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>                        </span>os<span style=color:#1f2328>.</span><span style=color:#1f2328>write</span><span style=color:#1f2328>(</span>response<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>                    </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>                </span><span style=color:#1f2328>}</span><span style=color:#fff> </span><span style=color:#cf222e>catch</span><span style=color:#fff> </span><span style=color:#1f2328>(</span>Exception<span style=color:#fff> </span>e<span style=color:#1f2328>)</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>                    </span>exchange<span style=color:#1f2328>.</span><span style=color:#1f2328>sendResponseHeaders</span><span style=color:#1f2328>(</span>500<span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>-</span>1<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>                </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#1f2328>}</span><span style=color:#fff> </span><span style=color:#cf222e>else</span><span style=color:#fff> </span><span style=color:#1f2328>{</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>                </span>exchange<span style=color:#1f2328>.</span><span style=color:#1f2328>sendResponseHeaders</span><span style=color:#1f2328>(</span>405<span style=color:#1f2328>,</span><span style=color:#fff> </span><span style=color:#0550ae>-</span>1<span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>            </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span><span style=color:#1f2328>});</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span>server<span style=color:#1f2328>.</span><span style=color:#1f2328>setExecutor</span><span style=color:#1f2328>(</span><span style=color:#cf222e>null</span><span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span>server<span style=color:#1f2328>.</span><span style=color:#1f2328>start</span><span style=color:#1f2328>();</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>        </span>System<span style=color:#1f2328>.</span><span style=color:#1f2328>out</span><span style=color:#1f2328>.</span><span style=color:#1f2328>println</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#34;Serveur démarré sur http://localhost:8000/&#34;</span><span style=color:#1f2328>);</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#fff>    </span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span><span style=display:flex><span><span style=color:#1f2328>}</span><span style=color:#fff>
</span></span></span></code></pre></div><p><code>index.html</code> :</p><div class=highlight><pre tabindex=0 style=background-color:#f7f7f7;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-text-size-adjust:none><code class=language-html data-lang=html><span style=display:flex><span><span style=color:#57606a>&lt;!DOCTYPE html&gt;</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>&lt;</span><span style=color:#0550ae>html</span> <span style=color:#1f2328>lang</span><span style=color:#0550ae>=</span><span style=color:#0a3069>&#34;fr&#34;</span><span style=color:#1f2328>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>&lt;</span><span style=color:#0550ae>head</span><span style=color:#1f2328>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>&lt;</span><span style=color:#0550ae>meta</span> <span style=color:#1f2328>charset</span><span style=color:#0550ae>=</span><span style=color:#0a3069>&#34;UTF-8&#34;</span><span style=color:#1f2328>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>&lt;</span><span style=color:#0550ae>title</span><span style=color:#1f2328>&gt;</span>Serveur d&#39;Heure<span style=color:#1f2328>&lt;/</span><span style=color:#0550ae>title</span><span style=color:#1f2328>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>&lt;/</span><span style=color:#0550ae>head</span><span style=color:#1f2328>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>&lt;</span><span style=color:#0550ae>body</span><span style=color:#1f2328>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>&lt;</span><span style=color:#0550ae>h1</span><span style=color:#1f2328>&gt;</span>Serveur d&#39;heure<span style=color:#1f2328>&lt;/</span><span style=color:#0550ae>h1</span><span style=color:#1f2328>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>&lt;</span><span style=color:#0550ae>p</span><span style=color:#1f2328>&gt;</span>Heure actuelle: <span style=color:#1f2328>&lt;</span><span style=color:#0550ae>span</span> <span style=color:#1f2328>id</span><span style=color:#0550ae>=</span><span style=color:#0a3069>&#34;time&#34;</span><span style=color:#1f2328>&gt;&lt;/</span><span style=color:#0550ae>span</span><span style=color:#1f2328>&gt;&lt;/</span><span style=color:#0550ae>p</span><span style=color:#1f2328>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>&lt;</span><span style=color:#0550ae>button</span> <span style=color:#1f2328>id</span><span style=color:#0550ae>=</span><span style=color:#0a3069>&#34;fetchBtn&#34;</span><span style=color:#1f2328>&gt;</span>Obtenir l&#39;heure<span style=color:#1f2328>&lt;/</span><span style=color:#0550ae>button</span><span style=color:#1f2328>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>&lt;</span><span style=color:#0550ae>h2</span><span style=color:#1f2328>&gt;</span>XML brut:<span style=color:#1f2328>&lt;/</span><span style=color:#0550ae>h2</span><span style=color:#1f2328>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>&lt;</span><span style=color:#0550ae>pre</span> <span style=color:#1f2328>id</span><span style=color:#0550ae>=</span><span style=color:#0a3069>&#34;rawXml&#34;</span><span style=color:#1f2328>&gt;&lt;/</span><span style=color:#0550ae>pre</span><span style=color:#1f2328>&gt;</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>&lt;</span><span style=color:#0550ae>script</span><span style=color:#1f2328>&gt;</span>
</span></span><span style=display:flex><span>        <span style=color:#6639ba>document</span><span style=color:#1f2328>.</span><span style=color:#1f2328>getElementById</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#39;fetchBtn&#39;</span><span style=color:#1f2328>).</span><span style=color:#1f2328>addEventListener</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#39;click&#39;</span><span style=color:#1f2328>,</span> <span style=color:#cf222e>function</span><span style=color:#1f2328>()</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>            <span style=color:#1f2328>fetch</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#39;/heure&#39;</span><span style=color:#1f2328>)</span>
</span></span><span style=display:flex><span>                <span style=color:#1f2328>.</span><span style=color:#1f2328>then</span><span style=color:#1f2328>(</span><span style=color:#1f2328>response</span> <span style=color:#1f2328>=&gt;</span> <span style=color:#1f2328>response</span><span style=color:#1f2328>.</span><span style=color:#1f2328>text</span><span style=color:#1f2328>())</span>
</span></span><span style=display:flex><span>                <span style=color:#1f2328>.</span><span style=color:#1f2328>then</span><span style=color:#1f2328>(</span><span style=color:#1f2328>xmlString</span> <span style=color:#1f2328>=&gt;</span> <span style=color:#1f2328>{</span>
</span></span><span style=display:flex><span>                    <span style=color:#cf222e>const</span> <span style=color:#1f2328>parser</span> <span style=color:#0550ae>=</span> <span style=color:#cf222e>new</span> <span style=color:#1f2328>DOMParser</span><span style=color:#1f2328>();</span>
</span></span><span style=display:flex><span>                    <span style=color:#cf222e>const</span> <span style=color:#1f2328>xmlDoc</span> <span style=color:#0550ae>=</span> <span style=color:#1f2328>parser</span><span style=color:#1f2328>.</span><span style=color:#1f2328>parseFromString</span><span style=color:#1f2328>(</span><span style=color:#1f2328>xmlString</span><span style=color:#1f2328>,</span> <span style=color:#0a3069>&#39;application/xml&#39;</span><span style=color:#1f2328>);</span>
</span></span><span style=display:flex><span>                    <span style=color:#cf222e>const</span> <span style=color:#1f2328>time</span> <span style=color:#0550ae>=</span> <span style=color:#1f2328>xmlDoc</span><span style=color:#1f2328>.</span><span style=color:#1f2328>getElementsByTagName</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#39;heure&#39;</span><span style=color:#1f2328>)[</span><span style=color:#0550ae>0</span><span style=color:#1f2328>].</span><span style=color:#1f2328>textContent</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>                    <span style=color:#6639ba>document</span><span style=color:#1f2328>.</span><span style=color:#1f2328>getElementById</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#39;time&#39;</span><span style=color:#1f2328>).</span><span style=color:#1f2328>textContent</span> <span style=color:#0550ae>=</span> <span style=color:#1f2328>time</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>                    <span style=color:#6639ba>document</span><span style=color:#1f2328>.</span><span style=color:#1f2328>getElementById</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#39;rawXml&#39;</span><span style=color:#1f2328>).</span><span style=color:#1f2328>textContent</span> <span style=color:#0550ae>=</span> <span style=color:#1f2328>xmlString</span><span style=color:#1f2328>;</span>
</span></span><span style=display:flex><span>                <span style=color:#1f2328>})</span>
</span></span><span style=display:flex><span>                <span style=color:#1f2328>.</span><span style=color:#cf222e>catch</span><span style=color:#1f2328>(</span><span style=color:#1f2328>error</span> <span style=color:#1f2328>=&gt;</span> <span style=color:#1f2328>console</span><span style=color:#1f2328>.</span><span style=color:#1f2328>error</span><span style=color:#1f2328>(</span><span style=color:#0a3069>&#39;Erreur:&#39;</span><span style=color:#1f2328>,</span> <span style=color:#1f2328>error</span><span style=color:#1f2328>));</span>
</span></span><span style=display:flex><span>        <span style=color:#1f2328>});</span>
</span></span><span style=display:flex><span>    <span style=color:#1f2328>&lt;/</span><span style=color:#0550ae>script</span><span style=color:#1f2328>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>&lt;/</span><span style=color:#0550ae>body</span><span style=color:#1f2328>&gt;</span>
</span></span><span style=display:flex><span><span style=color:#1f2328>&lt;/</span><span style=color:#0550ae>html</span><span style=color:#1f2328>&gt;</span>
</span></span></code></pre></div><h2 id=utilisation>Utilisation
<a class=anchor href=#utilisation>#</a></h2><ol><li><p>Compilez le programme Java :</p><pre tabindex=0><code>javac ServeurHeure.java
</code></pre></li><li><p>Lancez le serveur :</p><pre tabindex=0><code>java ServeurHeure
</code></pre><p>Attention. Si un autre serveur sur votre machine utilise le port 8000, le serveur ne pourra pas démarrer correctement. Vous pouvez changer le port dans le programme ou mettre fin à l&rsquo;autre serveur.</p></li><li><p>Ouvrez un navigateur et allez à <code>http://localhost:8000/</code>. Cliquez sur le bouton &ldquo;Obtenir l&rsquo;heure&rdquo; pour récupérer et afficher l&rsquo;heure actuelle. Le XML brut est également affiché en bas de la page.</p></li><li><p>Vous pouvez également accéder directement à <code>http://localhost:8000/heure</code> pour obtenir l&rsquo;XML de l&rsquo;heure.</p></li></ol><h2 id=description-du-code>Description du code
<a class=anchor href=#description-du-code>#</a></h2><h3 id=serveurheurejava>ServeurHeure.java
<a class=anchor href=#serveurheurejava>#</a></h3><p>Ce fichier contient la classe principale <code>ServeurHeure</code>. Il utilise l&rsquo;API <code>HttpServer</code> de Java pour créer un serveur HTTP simple écoutant sur le port 8000.</p><ul><li><strong>Imports</strong> : Inclut les classes nécessaires pour le serveur HTTP, la génération XML avec StAX, la lecture de fichiers, et la manipulation des dates.</li><li><strong>Méthode <code>genererXmlHeure()</code></strong> : Génère un document XML simple avec l&rsquo;heure actuelle au format ISO. Utilise <code>XMLOutputFactory</code> et <code>XMLStreamWriter</code> pour construire le XML de manière programmatique.</li><li><strong>Méthode <code>main()</code></strong> :<ul><li>Crée une instance d&rsquo;<code>HttpServer</code>.</li><li>Définit deux contextes de gestion des requêtes :<ul><li>Pour <code>/</code> : Lit le fichier <code>index.html</code> et le sert avec le type MIME <code>text/html</code>.</li><li>Pour <code>/heure</code> : Appelle <code>genererXmlHeure()</code> et sert le XML avec le type MIME <code>application/xml</code>.</li></ul></li><li>Démarre le serveur et affiche un message de confirmation.</li></ul></li></ul><h3 id=indexhtml>index.html
<a class=anchor href=#indexhtml>#</a></h3><p>Page web statique servie par le serveur.</p><ul><li><strong>Structure HTML</strong> : Titre, paragraphe pour afficher l&rsquo;heure, bouton pour déclencher la requête, et section pour afficher le XML brut.</li><li><strong>JavaScript</strong> :<ul><li>Écouteur d&rsquo;événement sur le bouton qui effectue une requête <code>fetch</code> vers <code>/heure</code>.</li><li>Analyse la réponse XML avec <code>DOMParser</code>.</li><li>Extrait le contenu de l&rsquo;élément <code>&lt;heure></code> pour l&rsquo;afficher.</li><li>Affiche également le XML brut dans un élément <code>&lt;pre></code>.</li></ul></li></ul><h2 id=activités-suggérées>Activités suggérées
<a class=anchor href=#activit%c3%a9s-sugg%c3%a9r%c3%a9es>#</a></h2><ol><li><p><strong>Modifier le format XML</strong> : Changez la structure du XML généré (par exemple, ajoutez des éléments pour la date et l&rsquo;heure séparément) et mettez à jour le JavaScript pour analyser la nouvelle structure.</p></li><li><p><strong>Ajouter un endpoint pour la date</strong> : Créez un nouveau contexte <code>/date</code> qui retourne la date actuelle en JSON, et ajoutez un bouton dans l&rsquo;HTML pour le récupérer et l&rsquo;afficher.</p></li><li><p><strong>Améliorer l&rsquo;interface utilisateur</strong> : Ajoutez du CSS pour styliser la page (par exemple, centrer le contenu, changer les couleurs) et peut-être une fonctionnalité pour rafraîchir l&rsquo;heure automatiquement toutes les minutes.</p></li><li><p><strong>Convertissez le service en JSON</strong> : Pouvez-vous remplacer le serveur basé sur XML par un serveur basé sur JSON?</p></li></ol></article><footer class=book-footer><div class="flex flex-wrap justify-between"></div><div class="flex flex-wrap justify-between"><a href=/orientee_donnees/docs/modules/e_module_services/introservicesweb/ class="flex align-center float-left book-icon"><img src=/orientee_donnees/svg/backward.svg alt=Previous title="Introduction aux services web">
<span>Introduction aux services web</span>
</a><a href=/orientee_donnees/docs/modules/e_module_services/yaml/ class="flex align-center float-right book-icon"><span>YAML</span>
<img src=/orientee_donnees/svg/forward.svg alt=Next title=YAML></a></div><script>(function(){function e(e){const t=window.getSelection(),n=document.createRange();n.selectNodeContents(e),t.removeAllRanges(),t.addRange(n)}document.querySelectorAll("pre code").forEach(t=>{t.addEventListener("click",function(){if(window.getSelection().toString())return;e(t.parentElement),navigator.clipboard&&navigator.clipboard.writeText(t.parentElement.textContent)})})})()</script></footer><div class=book-comments></div><label for=menu-control class="hidden book-menu-overlay"></label></div><aside class=book-toc><div class=book-toc-content><nav id=TableOfContents><ul><li><a href=#fichiers>Fichiers</a></li><li><a href=#utilisation>Utilisation</a></li><li><a href=#description-du-code>Description du code</a><ul><li><a href=#serveurheurejava>ServeurHeure.java</a></li><li><a href=#indexhtml>index.html</a></li></ul></li><li><a href=#activités-suggérées>Activités suggérées</a></li></ul></nav></div></aside></main></body></html>